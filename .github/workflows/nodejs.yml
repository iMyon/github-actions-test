name: Node CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Use Node.js 10.x
      uses: actions/setup-node@v1
      with:
        version: 10.x
    - name: npm install, build, and test
      run: |
        npm install
        npm test

  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: scp
      run: |
        ls
        echo "${{secrets.DEPLOY_KEY}}" > ./private.key
        chmod 700 ./private.key
        scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -P ${{secrets.DEPLOY_HOST_PORT}} -i ./private.key ./index.html ${{secrets.DEPLOY_HOST_USER}}@${{secrets.DEPLOY_HOST}}:${{secrets.DEPLOY_FOLDER}}
